<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- Find Dominators of a graph.</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Author: Bertram Felgenhauer &lt;int-e@gmx.de&gt;</span><span>
</span><span id="line-4"></span><span class="hs-comment">--</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Implementation based on</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Keith D. Cooper, Timothy J. Harvey, Ken Kennedy,</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- &quot;A Simple, Fast Dominance Algorithm&quot;,</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- (http://citeseer.ist.psu.edu/cooper01simple.html)</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Graph.Inductive.Query.Dominators</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#dom"><span class="hs-identifier">dom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#iDom"><span class="hs-identifier">iDom</span></a></span><span>
</span><span id="line-13"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Array</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Graph.Inductive.Graph.html"><span class="hs-identifier">Data.Graph.Inductive.Graph</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Graph.Inductive.Query.DFS.html"><span class="hs-identifier">Data.Graph.Inductive.Query.DFS</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IntMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap</span></span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Tree</span></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tree</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tree</span></span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# ANN</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#iDom"><span class="hs-pragma hs-type">iDom</span></a></span><span> </span><span class="annot"><span class="hs-pragma">&quot;HLint: ignore Use ***&quot;</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- | return immediate dominators for each node of a graph, given a root</span><span>
</span><span id="line-25"></span><span id="local-6989586621679076779"><span id="local-6989586621679076780"><span id="local-6989586621679076781"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#iDom"><span class="hs-identifier hs-type">iDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076781"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076781"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076780"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076779"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">,</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-26"></span><span id="iDom"><span class="annot"><span class="annottext">iDom :: gr a b -&gt; Node -&gt; [(Node, Node)]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#iDom"><span class="hs-identifier hs-var hs-var">iDom</span></a></span></span><span> </span><span id="local-6989586621679076778"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076778"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679076777"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076777"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679076776"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076776"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076775"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076775"><span class="hs-identifier hs-var">toNode</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FromNode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; Node -&gt; (IDom, IDom, FromNode)
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; (IDom, IDom, FromNode)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#idomWork"><span class="hs-identifier hs-var">idomWork</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076778"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076777"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-27"></span><span>              </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">((Node, Node) -&gt; (Node, Node)) -&gt; [(Node, Node)] -&gt; [(Node, Node)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679076773"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076773"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076772"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076772"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076775"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076773"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076775"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076772"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom -&gt; [(Node, Node)]
forall i e. Ix i =&gt; Array i e -&gt; [(i, e)]
</span><span class="hs-identifier hs-var">assocs</span></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076776"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | return the set of dominators of the nodes of a graph, given a root</span><span>
</span><span id="line-30"></span><span id="local-6989586621679076767"><span id="local-6989586621679076768"><span id="local-6989586621679076769"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#dom"><span class="hs-identifier hs-type">dom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076769"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076769"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076768"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076767"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-31"></span><span id="dom"><span class="annot"><span class="annottext">dom :: gr a b -&gt; Node -&gt; [(Node, [Node])]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#dom"><span class="hs-identifier hs-var hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621679076766"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076766"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679076765"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076765"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679076764"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076764"><span class="hs-identifier hs-var">iD</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076763"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076763"><span class="hs-identifier hs-var">toNode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076762"><span class="annot"><span class="annottext">FromNode
</span><a href="#local-6989586621679076762"><span class="hs-identifier hs-var">fromNode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; Node -&gt; (IDom, IDom, FromNode)
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; (IDom, IDom, FromNode)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#idomWork"><span class="hs-identifier hs-var">idomWork</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076766"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076765"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span id="local-6989586621679076761"><span class="annot"><span class="annottext">dom' :: Array Node [Node]
</span><a href="#local-6989586621679076761"><span class="hs-identifier hs-var hs-var">dom'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IDom -&gt; IDom -&gt; Array Node [Node]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#getDom"><span class="hs-identifier hs-var">getDom</span></a></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076763"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076764"><span class="hs-identifier hs-var">iD</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span id="local-6989586621679076759"><span class="annot"><span class="annottext">nodes' :: [Node]
</span><a href="#local-6989586621679076759"><span class="hs-identifier hs-var hs-var">nodes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gr a b -&gt; [Node]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [Node]
</span><a href="Data.Graph.Inductive.Graph.html#nodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076766"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621679076757"><span class="annot"><span class="annottext">rest :: [Node]
</span><a href="#local-6989586621679076757"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FromNode -&gt; [Node]
forall a. IntMap a -&gt; [Node]
</span><span class="hs-identifier hs-var">I.keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Node -&gt; Bool) -&gt; FromNode -&gt; FromNode
forall a. (a -&gt; Bool) -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">I.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FromNode
</span><a href="#local-6989586621679076762"><span class="hs-identifier hs-var">fromNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076763"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076754"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076761"><span class="hs-identifier hs-var">dom'</span></a></span><span> </span><span class="annot"><span class="annottext">Array Node [Node] -&gt; Node -&gt; [Node]
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076754"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679076754"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076754"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [Node]
forall a. Ix a =&gt; (a, a) -&gt; [a]
</span><span class="hs-identifier hs-var">range</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Node [Node] -&gt; (Node, Node)
forall i e. Array i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076761"><span class="hs-identifier hs-var">dom'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Node, [Node])] -&gt; [(Node, [Node])] -&gt; [(Node, [Node])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076751"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621679076759"><span class="hs-identifier hs-var">nodes'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679076751"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076751"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Node]
</span><a href="#local-6989586621679076757"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">-- internal node type</span><span>
</span><span id="line-41"></span><span class="hs-keyword">type</span><span> </span><span id="Node%27"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-var">Node'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- array containing the immediate dominator of each node, or an approximation</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- thereof. the dominance set of a node can be found by taking the union of</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- {node} and the dominance set of its immediate dominator.</span><span>
</span><span id="line-45"></span><span class="hs-keyword">type</span><span> </span><span id="IDom"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-var">IDom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span>
</span><span id="line-46"></span><span class="hs-comment">-- array containing the list of predecessors of each node</span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span id="Preds"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Preds"><span class="hs-identifier hs-var">Preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- arrays for translating internal nodes back to graph nodes and back</span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="ToNode"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#ToNode"><span class="hs-identifier hs-var">ToNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">type</span><span> </span><span id="FromNode"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#FromNode"><span class="hs-identifier hs-var">FromNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IntMap</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621679076858"><span id="local-6989586621679076859"><span id="local-6989586621679076861"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#idomWork"><span class="hs-identifier hs-type">idomWork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076861"><span class="hs-identifier hs-type">gr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076861"><span class="hs-identifier hs-type">gr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076859"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679076858"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-type">IDom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#ToNode"><span class="hs-identifier hs-type">ToNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#FromNode"><span class="hs-identifier hs-type">FromNode</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-53"></span><span id="idomWork"><span class="annot"><span class="annottext">idomWork :: gr a b -&gt; Node -&gt; (IDom, IDom, FromNode)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#idomWork"><span class="hs-identifier hs-var hs-var">idomWork</span></a></span></span><span> </span><span id="local-6989586621679076747"><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076747"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679076746"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076746"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- use depth first tree from root do build the first approximation</span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679076745"><span class="annot"><span class="annottext">trees :: [Tree Node]
</span><a href="#local-6989586621679076745"><span class="hs-identifier hs-var">trees</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-glyph">~</span><span class="hs-special">[</span><span id="local-6989586621679076744"><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076744"><span class="hs-identifier hs-var">tree</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node] -&gt; gr a b -&gt; [Tree Node]
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
[Node] -&gt; gr a b -&gt; [Tree Node]
</span><a href="Data.Graph.Inductive.Query.DFS.html#dff"><span class="hs-identifier hs-var">dff</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076746"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076747"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- relabel the tree so that paths from the root have increasing nodes</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679076742"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076742"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076741"><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076741"><span class="hs-identifier hs-var">ntree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Tree Node -&gt; (Node, Tree Node)
forall a. Node -&gt; Tree a -&gt; (Node, Tree Node)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberTree"><span class="hs-identifier hs-var">numberTree</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076744"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- the approximation iDom0 just maps each node to its parent</span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621679076739"><span class="annot"><span class="annottext">iD0 :: IDom
</span><a href="#local-6989586621679076739"><span class="hs-identifier hs-var hs-var">iD0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [(Node, Node)] -&gt; IDom
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076742"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Node, Node)] -&gt; [(Node, Node)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">([(Node, Node)] -&gt; [(Node, Node)])
-&gt; [(Node, Node)] -&gt; [(Node, Node)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Tree Node -&gt; [(Node, Node)]
forall a. a -&gt; Tree a -&gt; [(a, a)]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#treeEdges"><span class="hs-identifier hs-var">treeEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076741"><span class="hs-identifier hs-var">ntree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-comment">-- fromNode translates graph nodes to relabeled (internal) nodes</span><span>
</span><span id="line-61"></span><span>    </span><span id="local-6989586621679076735"><span class="annot"><span class="annottext">fromNode :: FromNode
</span><a href="#local-6989586621679076735"><span class="hs-identifier hs-var hs-var">fromNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Node -&gt; Node) -&gt; FromNode -&gt; FromNode -&gt; FromNode
forall a. (a -&gt; a -&gt; a) -&gt; IntMap a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">I.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Node, Node)] -&gt; FromNode
forall a. [(Node, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">I.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node] -&gt; [Node] -&gt; [(Node, Node)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Node -&gt; [Node]
forall a. Tree a -&gt; [a]
</span><span class="hs-identifier hs-var">T.flatten</span></span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076744"><span class="hs-identifier hs-var">tree</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Node -&gt; [Node]
forall a. Tree a -&gt; [a]
</span><span class="hs-identifier hs-var">T.flatten</span></span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076741"><span class="hs-identifier hs-var">ntree</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Node, Node)] -&gt; FromNode
forall a. [(Node, a)] -&gt; IntMap a
</span><span class="hs-identifier hs-var">I.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node] -&gt; [Node] -&gt; [(Node, Node)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gr a b -&gt; [Node]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [Node]
</span><a href="Data.Graph.Inductive.Graph.html#nodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076747"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node -&gt; [Node]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-comment">-- toNode translates internal nodes to graph nodes</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621679076729"><span class="annot"><span class="annottext">toNode :: IDom
</span><a href="#local-6989586621679076729"><span class="hs-identifier hs-var hs-var">toNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [(Node, Node)] -&gt; IDom
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076742"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node] -&gt; [Node] -&gt; [(Node, Node)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Node -&gt; [Node]
forall a. Tree a -&gt; [a]
</span><span class="hs-identifier hs-var">T.flatten</span></span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076741"><span class="hs-identifier hs-var">ntree</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree Node -&gt; [Node]
forall a. Tree a -&gt; [a]
</span><span class="hs-identifier hs-var">T.flatten</span></span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076744"><span class="hs-identifier hs-var">tree</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621679076728"><span class="annot"><span class="annottext">preds :: Array Node [Node]
</span><a href="#local-6989586621679076728"><span class="hs-identifier hs-var hs-var">preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [(Node, [Node])] -&gt; Array Node [Node]
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076742"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076727"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Node -&gt; Bool) -&gt; [Node] -&gt; [Node]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Node -&gt; Node) -&gt; [Node] -&gt; [Node]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FromNode
</span><a href="#local-6989586621679076735"><span class="hs-identifier hs-var">fromNode</span></a></span><span> </span><span class="annot"><span class="annottext">FromNode -&gt; Node -&gt; Node
forall a. IntMap a -&gt; Node -&gt; a
</span><span class="hs-operator hs-var">I.!</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">gr a b -&gt; Node -&gt; [Node]
forall (gr :: * -&gt; * -&gt; *) a b.
Graph gr =&gt;
gr a b -&gt; Node -&gt; [Node]
</span><a href="Data.Graph.Inductive.Graph.html#pre"><span class="hs-identifier hs-var">pre</span></a></span><span> </span><span class="annot"><span class="annottext">gr a b
</span><a href="#local-6989586621679076747"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076729"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076727"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679076727"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076727"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076742"><span class="hs-identifier hs-var">s</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- iteratively improve the approximation to find iDom.</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679076723"><span class="annot"><span class="annottext">iD :: IDom
</span><a href="#local-6989586621679076723"><span class="hs-identifier hs-var hs-var">iD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IDom -&gt; IDom) -&gt; IDom -&gt; IDom
forall a. Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Data.Graph.Inductive.Query.Dominators.html#fixEq"><span class="hs-identifier hs-var">fixEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Node [Node] -&gt; IDom -&gt; IDom
</span><a href="Data.Graph.Inductive.Query.Dominators.html#refineIDom"><span class="hs-identifier hs-var">refineIDom</span></a></span><span> </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076728"><span class="hs-identifier hs-var">preds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076739"><span class="hs-identifier hs-var">iD0</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Tree Node] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Tree Node]
</span><a href="#local-6989586621679076745"><span class="hs-identifier hs-var">trees</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (IDom, IDom, FromNode)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Dominators.idomWork: root not in graph&quot;</span></span><span>
</span><span id="line-70"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076723"><span class="hs-identifier hs-var">iD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076729"><span class="hs-identifier hs-var">toNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FromNode
</span><a href="#local-6989586621679076735"><span class="hs-identifier hs-var">fromNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- for each node in iDom, find the intersection of all its predecessor's</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- dominating sets, and update iDom accordingly.</span><span>
</span><span id="line-74"></span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#refineIDom"><span class="hs-identifier hs-type">refineIDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Preds"><span class="hs-identifier hs-type">Preds</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-type">IDom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-type">IDom</span></a></span><span>
</span><span id="line-75"></span><span id="refineIDom"><span class="annot"><span class="annottext">refineIDom :: Array Node [Node] -&gt; IDom -&gt; IDom
</span><a href="Data.Graph.Inductive.Query.Dominators.html#refineIDom"><span class="hs-identifier hs-var hs-var">refineIDom</span></a></span></span><span> </span><span id="local-6989586621679076718"><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076718"><span class="hs-identifier hs-var">preds</span></a></span></span><span> </span><span id="local-6989586621679076717"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076717"><span class="hs-identifier hs-var">iD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Node] -&gt; Node) -&gt; Array Node [Node] -&gt; IDom
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Node -&gt; Node -&gt; Node) -&gt; [Node] -&gt; Node
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldl1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node -&gt; Node
</span><a href="Data.Graph.Inductive.Query.Dominators.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076717"><span class="hs-identifier hs-var">iD</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076718"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- find the intersection of the two given dominance sets.</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#intersect"><span class="hs-identifier hs-type">intersect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-type">IDom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span>
</span><span id="line-79"></span><span id="intersect"><span class="annot"><span class="annottext">intersect :: IDom -&gt; Node -&gt; Node -&gt; Node
</span><a href="Data.Graph.Inductive.Query.Dominators.html#intersect"><span class="hs-identifier hs-var hs-var">intersect</span></a></span></span><span> </span><span id="local-6989586621679076714"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076714"><span class="hs-identifier hs-var">iD</span></a></span></span><span> </span><span id="local-6989586621679076713"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076713"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679076712"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076712"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076713"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076712"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node -&gt; Node
</span><a href="Data.Graph.Inductive.Query.Dominators.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076714"><span class="hs-identifier hs-var">iD</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076713"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076714"><span class="hs-identifier hs-var">iD</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076712"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076713"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node -&gt; Node
</span><a href="Data.Graph.Inductive.Query.Dominators.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076714"><span class="hs-identifier hs-var">iD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076714"><span class="hs-identifier hs-var">iD</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076713"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076712"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- convert an IDom to dominance sets. we translate to graph nodes here</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- because mapping later would be more expensive and lose sharing.</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#getDom"><span class="hs-identifier hs-type">getDom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#ToNode"><span class="hs-identifier hs-type">ToNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#IDom"><span class="hs-identifier hs-type">IDom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Data.Graph.Inductive.Graph.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-87"></span><span id="getDom"><span class="annot"><span class="annottext">getDom :: IDom -&gt; IDom -&gt; Array Node [Node]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#getDom"><span class="hs-identifier hs-var hs-var">getDom</span></a></span></span><span> </span><span id="local-6989586621679076710"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076710"><span class="hs-identifier hs-var">toNode</span></a></span></span><span> </span><span id="local-6989586621679076709"><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076709"><span class="hs-identifier hs-var">iD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679076708"><span class="annot"><span class="annottext">res :: Array Node [Node]
</span><a href="#local-6989586621679076708"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [(Node, [Node])] -&gt; Array Node [Node]
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><span class="hs-identifier hs-var">array</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; Node
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom -&gt; (Node, Node)
forall i e. Array i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076709"><span class="hs-identifier hs-var">iD</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076710"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Node, [Node]) -&gt; [(Node, [Node])] -&gt; [(Node, [Node])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-89"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076707"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076710"><span class="hs-identifier hs-var">toNode</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076707"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Node -&gt; [Node] -&gt; [Node]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076708"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Array Node [Node] -&gt; Node -&gt; [Node]
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076709"><span class="hs-identifier hs-var">iD</span></a></span><span> </span><span class="annot"><span class="annottext">IDom -&gt; Node -&gt; Node
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076707"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679076707"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076707"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Node, Node) -&gt; [Node]
forall a. Ix a =&gt; (a, a) -&gt; [a]
</span><span class="hs-identifier hs-var">range</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IDom -&gt; (Node, Node)
forall i e. Array i e -&gt; (i, i)
</span><span class="hs-identifier hs-var">bounds</span></span><span> </span><span class="annot"><span class="annottext">IDom
</span><a href="#local-6989586621679076709"><span class="hs-identifier hs-var">iD</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Array Node [Node]
</span><a href="#local-6989586621679076708"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- relabel tree, labeling vertices with consecutive numbers in depth first order</span><span>
</span><span id="line-94"></span><span id="local-6989586621679076829"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#numberTree"><span class="hs-identifier hs-type">numberTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><a href="#local-6989586621679076829"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-95"></span><span id="numberTree"><span class="annot"><span class="annottext">numberTree :: Node -&gt; Tree a -&gt; (Node, Tree Node)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberTree"><span class="hs-identifier hs-var hs-var">numberTree</span></a></span></span><span> </span><span id="local-6989586621679076706"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076706"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679076704"><span class="annot"><span class="annottext">Forest a
</span><a href="#local-6989586621679076704"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679076703"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076703"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076702"><span class="annot"><span class="annottext">[Tree Node]
</span><a href="#local-6989586621679076702"><span class="hs-identifier hs-var">ts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Forest a -&gt; (Node, [Tree Node])
forall a. Node -&gt; [Tree a] -&gt; (Node, [Tree Node])
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberForest"><span class="hs-identifier hs-var">numberForest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076706"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Node -&gt; Node -&gt; Node
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Node
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Forest a
</span><a href="#local-6989586621679076704"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-96"></span><span>                           </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076703"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node -&gt; [Tree Node] -&gt; Tree Node
forall a. a -&gt; Forest a -&gt; Tree a
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076706"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Tree Node]
</span><a href="#local-6989586621679076702"><span class="hs-identifier hs-var">ts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- same as numberTree, for forests.</span><span>
</span><span id="line-99"></span><span id="local-6989586621679076791"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#numberForest"><span class="hs-identifier hs-type">numberForest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><a href="#local-6989586621679076791"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#Node%27"><span class="hs-identifier hs-type">Node'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-100"></span><span id="numberForest"><span class="annot"><span class="annottext">numberForest :: Node -&gt; [Tree a] -&gt; (Node, [Tree Node])
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberForest"><span class="hs-identifier hs-var hs-var">numberForest</span></a></span></span><span> </span><span id="local-6989586621679076699"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076699"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076699"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#numberForest"><span class="hs-identifier hs-var">numberForest</span></a></span><span> </span><span id="local-6989586621679076698"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076698"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679076697"><span class="annot"><span class="annottext">Tree a
</span><a href="#local-6989586621679076697"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679076696"><span class="annot"><span class="annottext">[Tree a]
</span><a href="#local-6989586621679076696"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679076695"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076695"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076694"><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076694"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; Tree a -&gt; (Node, Tree Node)
forall a. Node -&gt; Tree a -&gt; (Node, Tree Node)
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberTree"><span class="hs-identifier hs-var">numberTree</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076698"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Tree a
</span><a href="#local-6989586621679076697"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-102"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621679076693"><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076693"><span class="hs-identifier hs-var">n''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679076692"><span class="annot"><span class="annottext">[Tree Node]
</span><a href="#local-6989586621679076692"><span class="hs-identifier hs-var">ts'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node -&gt; [Tree a] -&gt; (Node, [Tree Node])
forall a. Node -&gt; [Tree a] -&gt; (Node, [Tree Node])
</span><a href="Data.Graph.Inductive.Query.Dominators.html#numberForest"><span class="hs-identifier hs-var">numberForest</span></a></span><span> </span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076695"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">[Tree a]
</span><a href="#local-6989586621679076696"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-103"></span><span>                        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node
</span><a href="#local-6989586621679076693"><span class="hs-identifier hs-var">n''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tree Node
</span><a href="#local-6989586621679076694"><span class="hs-identifier hs-var">t'</span></a></span><span class="annot"><span class="annottext">Tree Node -&gt; [Tree Node] -&gt; [Tree Node]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Tree Node]
</span><a href="#local-6989586621679076692"><span class="hs-identifier hs-var">ts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- return the edges of the tree, with an added dummy root node.</span><span>
</span><span id="line-106"></span><span id="local-6989586621679076821"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#treeEdges"><span class="hs-identifier hs-type">treeEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679076821"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="annot"><a href="#local-6989586621679076821"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679076821"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679076821"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-107"></span><span id="treeEdges"><span class="annot"><span class="annottext">treeEdges :: a -&gt; Tree a -&gt; [(a, a)]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#treeEdges"><span class="hs-identifier hs-var hs-var">treeEdges</span></a></span></span><span> </span><span id="local-6989586621679076691"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076691"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Node</span></span><span> </span><span id="local-6989586621679076690"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076690"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679076689"><span class="annot"><span class="annottext">Forest a
</span><a href="#local-6989586621679076689"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076690"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076691"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; [(a, a)] -&gt; [(a, a)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Tree a -&gt; [(a, a)]) -&gt; Forest a -&gt; [(a, a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Tree a -&gt; [(a, a)]
forall a. a -&gt; Tree a -&gt; [(a, a)]
</span><a href="Data.Graph.Inductive.Query.Dominators.html#treeEdges"><span class="hs-identifier hs-var">treeEdges</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076690"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Forest a
</span><a href="#local-6989586621679076689"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- find a fixed point of f, iteratively</span><span>
</span><span id="line-110"></span><span id="local-6989586621679076807"><span class="annot"><a href="Data.Graph.Inductive.Query.Dominators.html#fixEq"><span class="hs-identifier hs-type">fixEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679076807"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679076807"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076807"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076807"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076807"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-111"></span><span id="fixEq"><span class="annot"><span class="annottext">fixEq :: (a -&gt; a) -&gt; a -&gt; a
</span><a href="Data.Graph.Inductive.Query.Dominators.html#fixEq"><span class="hs-identifier hs-var hs-var">fixEq</span></a></span></span><span> </span><span id="local-6989586621679076687"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679076687"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679076686"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076686"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076685"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076686"><span class="hs-identifier hs-var">v</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076686"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-112"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
forall a. Eq a =&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Data.Graph.Inductive.Query.Dominators.html#fixEq"><span class="hs-identifier hs-var">fixEq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679076687"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076685"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679076685"><span class="annot"><span class="annottext">v' :: a
</span><a href="#local-6989586621679076685"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679076687"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679076686"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">{-
:m +Data.Graph.Inductive
let g0 = mkGraph [(i,()) | i &lt;- [0..4]] [(a,b,()) | (a,b) &lt;- [(0,1),(1,2),(0,3),(3,2),(4,0)]] :: Gr () ()
let g1 = mkGraph [(i,()) | i &lt;- [0..4]] [(a,b,()) | (a,b) &lt;- [(0,1),(1,2),(2,3),(1,3),(3,4)]] :: Gr () ()
let g2,g3,g4 :: Int -&gt; Gr () (); g2 n = mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a,a+1,()) | a &lt;- [0..n-2]] ++ [(a,a+2,()) | a &lt;- [0..n-3]]); g3 n =mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a,a+2,()) | a &lt;- [0..n-3]] ++ [(a,a+1,()) | a &lt;- [0..n-2]]); g4 n =mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a+2,a,()) | a &lt;- [0..n-3]] ++ [(a+1,a,()) | a &lt;- [0..n-2]])
:m -Data.Graph.Inductive
-}</span><span>
</span><span id="line-122"></span></pre></body></html>